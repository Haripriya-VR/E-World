<%-include('../partials/profileheader') %>
  <style>
    input.form-control,
    textarea {
      background-color: #fff;
    }

    input:disabled {
      border: none;
      background-color: #fff;
      font-weight: bold;
    }

    .fs--1 a {
      color: #000000;
      padding: 10px;
      text-decoration: none;

    }

    .fs--1 a.active {
      background-color: #7a7a7a;
      color: #fff;
    }

    .fs--1 a:hover {
      background: #AB79D3;
      color: white;
    }
  </style>

  <body>

    <div class="container row m-auto ">
      <div class="col-lg-3">

        <div class="d-flex ">
          <img src="/static/images/profile-pic.png" alt="" style="height: 200px;" class=" mt-2">
        </div>
        <h6 class="pt-3">
          <%= email %>
        </h6>
        <div class="w-100">
          <hr>
        </div>

        <div class="fs--1 fw-600">
          <a class=" d-block mb-2" href="/profile">PROFILE</a>
          <!-- <a id="bio-link" class=" d-block mb-2" onclick="editButton()">EDIT BIO</a> -->
          <a id="orders-link" class=" d-block mb-2" href="/profile/profile-orders">ORDERS</a>
          <!-- <a id="addresses-link" class=" d-block mb-2" href="/user/address">MANAGE ADDRESS</a> -->

        </div>
      </div>

      <div class="col-lg-8 pt-3">
        <table class="table table-secondary table-hover">
          <thead>
            <tr>
              <th scope="col">Date</th>
              <th scope="col">Order ID</th>
              <th scope="col">Amount</th>
              <th scope="col">Status</th>
              <th></th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            <% if (orders?.length> 0) {
              orders.forEach(item => {
              %>
              <tr id="order-row-<%= item._id %>">
                <td>
                  <%= item.date.toLocaleDateString('en-GB') %>
                </td>

                <td>
                  <span class="text-dark">
                    <%= item._id.toString().slice(-6) %>
                  </span>
                </td>

                <td id="totalPrice">
                  <%= item.totalPrice %>
                </td>

                <td id="order-status-${orderId}">
                  <%= item.orderStatus %>
                </td>
                <td>
                  <!-- <a href="/profile-orders/<%= item._id %>  "  class="btn btn-danger">Cancel</a> -->

                  <button style="font-size: 12px;" id="cancel-<%= item._id %>" onclick="cancelOrder('<%= item._id %>')"
                    class="btn btn-danger rounded-0">
                    Cancel</button>
                </td>
                <td><a href="/profile-orderedproducts/<%= item._id %>" class="btn btn-info">view
                    products</a></td>
              </tr>
              <% }); } %>
          </tbody>
        </table>

      </div>

      <nav aria-label="Page navigation example" class="d-flex justify-content-center mt-3">
        <ul class="pagination">
          <% if (page> 1) { %>
            <li class="page-item">
              <a class="page-link" href="?page=<%= page - 1 %>&limit=8" aria-label="Previous">
                <span aria-hidden="true">&laquo;</span>
              </a>
            </li>
            <% } else { %>
              <li class="page-item disabled">
                <span class="page-link" aria-label="Previous">
                  <span aria-hidden="true">&laquo;</span>
                </span>
              </li>
              <% } %>
                <% for (let i=1; i <=totalPages; i++) { %>
                  <li class="page-item <%= page === i ? 'active' : '' %>">
                    <a class="page-link" href="?page=<%= i %>&limit=8">
                      <%= i %>
                    </a>
                  </li>
                  <% } %>
                    <% if (page < totalPages) { %>
                      <li class="page-item">
                        <a class="page-link" href="?page=<%= page + 1 %>&limit=8" aria-label="Next">
                          <span aria-hidden="true">&raquo;</span>
                        </a>
                      </li>
                      <% } else { %>
                        <li class="page-item disabled">
                          <span class="page-link" aria-label="Next">
                            <span aria-hidden="true">&raquo;</span>
                          </span>
                        </li>
                        <% } %>

        </ul>
      </nav>
    </div>
  </body>

  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>



  <script>

    // async function cancelOrder(orderId) {
    //   try {
    //     console.log(orderId);
    //     const status = 'Cancelled';
    //     const cancel = await axios.patch('/profile-orders/cancel-order', { orderId, status });

    //     if (cancel.data.success) {
    //       console.log(cancel.data);
    //       const cancelButton = document.getElementById(`cancel-${orderId}`);
    //       const order_status = document.getElementById(`order-status-${orderId}`);
    //       cancelButton.style.display = 'none';
    //       order_status.innerHTML = cancel.data.status
    //     }
    //   } catch (error) {
    //     console.log(error.message);
    //   }
    // }

    async function cancelOrder(orderId) {
    try {
        console.log(orderId);
        const status = 'Cancelled';
        const cancel = await axios.patch('/profile-orders/cancel-order', { orderId, status });

        if (cancel.data.success) {
            console.log(cancel.data);

            swal({
                text: "Do you want to cancel the order?",
                icon: "warning",
                buttons: true,
                dangerMode: true,
            }).then((willDelete) => {
                if (willDelete) {
                    swal("Order has been canceled!", {
                        icon: "success",
                    }).then(() => {
                        // After the user clicks "OK" on the SweetAlert, remove the order
                        const orderRow = document.getElementById(`order-row-${orderId}`);
                        if (orderRow) {
                            orderRow.remove();
                        }
                    });
                } 
            });
        }
    } catch (error) {
        console.log(error.message);
    }
}



  </script>